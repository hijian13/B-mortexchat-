<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>B-MortexChat</title>

<style>
body{
  font-family: Arial;
  margin:0;
  background:url('https://images.unsplash.com/photo-1501785888041-af3ef285b470') no-repeat center center fixed;
  background-size:cover;
}

header{
  background:rgba(0,0,0,0.8);
  color:white;
  padding:15px;
  text-align:center;
  font-size:22px;
}

.container{
  width:95%;
  max-width:600px;
  margin:auto;
  margin-top:15px;
  background:rgba(255,255,255,0.95);
  padding:15px;
  border-radius:10px;
}

#messages{
  height:250px;
  overflow-y:auto;
  border:1px solid #ccc;
  padding:10px;
  margin-bottom:10px;
}

.message{
  background:#e4e4e4;
  padding:6px;
  margin:6px 0;
  border-radius:6px;
}

button{
  padding:6px;
  margin:4px 0;
  background:#111;
  color:white;
  border:none;
  cursor:pointer;
}

input{
  padding:6px;
  margin:4px 0;
  width:100%;
}

.small{
  font-size:12px;
  color:gray;
}
</style>
</head>

<body>

<header>B-MortexChat</header>

<div class="container">

<input type="text" id="username" placeholder="Username yawe">

<h3>Group Chat</h3>
<div id="messages"></div>

<input type="text" id="messageInput" placeholder="Andika message...">
<button onclick="sendMessage()">Send</button>

<hr>

<h3>Create Post</h3>
<input type="text" id="postInput" placeholder="Andika post...">
<button onclick="createPost()">Post</button>

<div id="posts"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, increment } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "SHIRA_API_KEY",
  authDomain: "SHIRA_AUTH",
  projectId: "SHIRA_PROJECT_ID",
  storageBucket: "SHIRA_STORAGE",
  messagingSenderId: "SHIRA_ID",
  appId: "SHIRA_APP"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const usernameInput = document.getElementById("username");

window.sendMessage = async function(){

  const text = document.getElementById("messageInput").value;
  const username = usernameInput.value || "Anonymous";

  if(text === "") return;

  await addDoc(collection(db,"groupChat"),{
    username,
    text,
    createdAt:new Date()
  });

  if(text.toLowerCase().includes("ai")){
    await addDoc(collection(db,"groupChat"),{
      username:"AI Bot",
      text:"Ndakwumva ðŸ™‚ ikibazo cawe niki?",
      createdAt:new Date()
    });
  }

  document.getElementById("messageInput").value="";
}

onSnapshot(collection(db,"groupChat"),(snapshot)=>{
  const messagesDiv = document.getElementById("messages");
  messagesDiv.innerHTML="";
  snapshot.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement("div");
    div.className="message";
    div.innerHTML="<b>"+data.username+"</b>: "+data.text;
    messagesDiv.appendChild(div);
  });
});

window.createPost = async function(){
  const text = document.getElementById("postInput").value;
  const username = usernameInput.value || "Anonymous";

  if(text==="") return;

  await addDoc(collection(db,"posts"),{
    username,
    text,
    likes:0,
    createdAt:new Date()
  });

  document.getElementById("postInput").value="";
}

onSnapshot(collection(db,"posts"),(snapshot)=>{
  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML="";
  snapshot.forEach(d=>{
    const data = d.data();
    const div = document.createElement("div");
    div.className="message";

    div.innerHTML=
      "<b>"+data.username+"</b>: "+data.text+
      "<br><button onclick='likePost(\""+d.id+"\")'>Like ("+data.likes+")</button>"+
      "<div class='small'>Comments coming soon...</div>";

    postsDiv.appendChild(div);
  });
});

window.likePost = async function(id){
  const postRef = doc(db,"posts",id);
  await updateDoc(postRef,{
    likes:increment(1)
  });
}

</script>

</body>
</html>
